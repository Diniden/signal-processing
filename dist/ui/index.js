(function(m,P){typeof exports=="object"&&typeof module<"u"?P(exports):typeof define=="function"&&define.amd?define(["exports"],P):(m=typeof globalThis<"u"?globalThis:m||self,P(m["diniden_signal-processing"]={}))})(this,function(m){"use strict";class P{constructor(t,e){if(this.coefficients=t.map(n=>n[0]),this.filter=t.map(n=>n[1]),e!==void 0){let n=0;this.coefficients.forEach(i=>n+=i),this.coefficients=this.coefficients.map(i=>i/n*e)}}reset(t){this.filter=this.filter.map(()=>t)}stream(t){let e=0;this.filter.pop(),this.filter.unshift(t);for(let n=0,i=this.coefficients.length;n<i;++n)e+=this.coefficients[n]*this.filter[n];return this.filter.shift(),this.filter.unshift(e),e}run(t,e){const n=this.filter.slice(0),i=e.slice(0);this.reset(t);const s=[];for(;i.length>0;)s.push(this.stream(i.shift()||0));return this.filter=n,s}}class E{constructor(t){if(this.elements=[],t===0)return;const e=[[1]],n=t-1;for(let i=0;i<n;++i){const s=e[i],h=[1];for(let l=0,r=s.length-1;l<r;++l)h.push(s[l]+s[l+1]);h.push(1),e.push(h)}this.elements=e}gaussianKernal(t,e){const n=e*2;let i=[];for(let l=0,r=this.elements.length;l<r&&this.elements[l].length-n<=t;++l)i=this.elements[l];i.length-n!==t&&console.warn("Error in pascal triangle gaussian kernal","Requested size",t,"Row",i,"Trim amount",e,"Elements",this.elements);let s=i.slice(e,i.length-e);const h=s.reduce((l,r)=>r+l,0);return s=s.map(l=>l/h),{kernal:s,total:h}}}const{min:O,max:z}=Math;function I(b,t,e){return z(O(b,e),t)}class R{constructor(t){this.kernal=[],this.options=t,this.update(t)}generate(t,e=0,n=0,i=0,s=0){if(!t||!t[0]||!t[0].length)return t;const{passes:h}=this.options,l=this.kernal,r=t.map(u=>u.slice(0)),o=t.length,p=t[0].length,d={1:[0],3:[-1,0,1],5:[-2,-1,0,1,2],7:[-3,-2,-1,0,1,2,3],9:[-4,-3,-2,-1,0,1,2,3,4]}[l.length];if(!d)return console.warn("No offset suitable for kernal size"),t;const y=[];for(let u=0;u<o;++u)y.push([]);for(let u=0;u<h;++u){let c,g;for(let a=e,C=o-i;a<C;++a){const T=y[a],k=r[a];for(let w=n,x=p-s;w<x;++w){c=0;for(let v=0,G=l.length;v<G;++v)g=I(w+d[v],0,x-1),c+=(k[g]||0)*l[v];T[w]=c}}for(let a=e,C=o-i;a<C;++a){const T=r[a];for(let k=n,w=p-s;k<w;++k){c=0;for(let x=0,v=l.length;x<v;++x)g=I(a+d[x],0,C-1),c+=((y[g]||[])[k]||0)*l[x];T[k]=c}}}return r}update(t){Object.assign(this.options,t),t.kernalSize&&(this.kernal=new E(15).gaussianKernal(t.kernalSize,2).kernal)}}function S(b,t){return function(e){return(e-b[0])/(b[1]-b[0])*(t[1]-t[0]+t[0])}}const{abs:j,floor:F,max:M,min:N,random:B}=Math;class D{get width(){return this.options.width}get height(){return this.options.height}constructor(t){this.options=t,this.blur=new R({passes:t.blendPasses,kernalSize:9}),this.update(t)}async generate(){const{width:t,height:e,octaves:n,valueRange:i}=this.options;let s=[];n.forEach(o=>{const p=[],f=o[0],d=o[1],y=S([0,t],[0,f]),u=S([0,e],[0,d]);for(let c=0;c<f;++c){const g=[];p.push(g);for(let a=0;a<d;++a)g.push(B())}for(let c=0;c<t;++c){const g=s[c]=s[c]||[];for(let a=0;a<e;++a)g[a]=(g[a]||1)*p[F(y(c))][F(u(a))]}}),s=this.blur.generate(s);let h=-1;const l=i[1]-i[0],r=i[0];for(let o=0;o<t;++o){const p=s[o];for(let f=0;f<e;++f)h=M(p[f],h)}for(let o=0;o<t;++o){const p=s[o];for(let f=0;f<e;++f)p[f]/=h,p[f]=p[f]*l+r}this.data=s}async generateOnce(){this.data||await this.generate()}sample(t,e,n,i,s){const h=[];if(s)for(let l=t,r=N(this.data.length,t+n);l<r;++l)h.push(this.data[l].slice(e,e+i).map(o=>j(o)>s?o:0));else for(let l=t,r=N(this.data.length,t+n);l<r;++l)h.push(this.data[l].slice(e,e+i));return h}update(t){Object.assign(this.options,t),t.blendPasses&&this.blur.update({passes:t.blendPasses})}debug(t=0,e){if(e){this.debugContext&&this.debugContext.remove();return}const n=document.createElement("canvas").getContext("2d");if(n){const{valueRange:i}=this.options,s=n.canvas;document.getElementsByTagName("body")[0].appendChild(n.canvas);const h=s.width=this.data.length,l=s.height=this.data[0].length,r=n.getImageData(0,0,h,l);let o=0;const p=i[1]-i[0],f=i[0];if(t)for(let d=0,y=this.data.length;d<y;++d){const u=this.data[d];for(let c=0,g=u.length;c<g;++c){const a=255*(j(u[c])>t?1:0);r.data[o*4]=a,r.data[o*4+1]=a,r.data[o*4+2]=a,r.data[o*4+3]=255,o++}}else for(let d=0,y=this.data.length;d<y;++d){const u=this.data[d];for(let c=0,g=u.length;c<g;++c){const a=255*((u[c]-f)/p);r.data[o*4]=a,r.data[o*4+1]=a,r.data[o*4+2]=a,r.data[o*4+3]=255,o++}}n.putImageData(r,0,0),s.style.position="fixed",s.style.top="0px",s.style.left="0px",s.style.zIndex="9999",this.debugContext=s}}}m.FIRFilter=P,m.GaussianBlur=R,m.PascalTriangle=E,m.PerlinNoise=D,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
